package org.ap.auxpro.rest.servlet;

import javax.ws.rs.*;
import javax.ws.rs.core.*;
import javax.ws.rs.core.Response.*;
import org.ap.web.rest.servlet.APServletBase;
import org.ap.auxpro.bean.HelpTopicBean;
import org.ap.auxpro.storage.HelptopicData;
import org.ap.auxpro.storage.HelptopicCollection;
import org.ap.web.internal.APWebException;
import org.bson.conversions.Bson;
import static com.mongodb.client.model.Filters.*;
import org.ap.auxpro.storage.HelptopicFields;
import java.util.List;
import java.util.ArrayList;
import org.ap.common.TimeHelper;
import org.ap.auxpro.bean.HelpFaqBean;
import org.ap.auxpro.storage.HelpfaqData;
import org.ap.auxpro.storage.HelpfaqCollection;
import org.ap.auxpro.storage.HelpfaqFields;

/* This class was auto-generated by the JavaWriter */
@Path("/help")
public class HelpServlet extends APServletBase {

	public static final String PATH = "/help";

	@GET
	@Path("/topics")
	@Produces({MediaType.APPLICATION_JSON})
	public Response getHelpTopics(@Context SecurityContext sc, @Context UriInfo info) {
		try {
			List<Bson> conditions = new ArrayList<Bson>();
			
			for (String key : info.getQueryParameters().keySet()) {
				HelptopicFields field = HelptopicFields.byId(key);
				if (field != null) {
					List<Bson> subConditions = new ArrayList<Bson>();
					for (String value : info.getQueryParameters().get(key)) {
						if (field.getType().equals("Boolean")) {
							subConditions.add(eq(key, new Boolean(value)));
						} else {
							subConditions.add(eq(key, value));
						}
					}
					conditions.add(or(subConditions));
				}
			}
			
			List<HelptopicData> datas = null;
			if (conditions.size() > 0) {
				datas = HelptopicCollection.get(and(conditions));
			} else {
				datas = HelptopicCollection.getAll();
			}
			
			List<HelpTopicBean> beanList = new ArrayList<HelpTopicBean>();
			for (HelptopicData data : datas) {
				HelpTopicBean bean = new HelpTopicBean();
				bean.lastUpdateDate = TimeHelper.toIntegers(data.getLastUpdateDate());
				bean.id = data.getId();
				bean.title = data.getTitle();
				bean.creationDate = TimeHelper.toIntegers(data.getCreationDate());
				bean.content = data.getContent();
				
				beanList.add(bean);
			}
			
			return Response.status(Status.OK).entity(beanList.toArray(new HelpTopicBean[beanList.size()])).build();
			
		} catch (APWebException e) {
			return sendException(e);
		} catch (Exception e) {
			return Response.status(Status.INTERNAL_SERVER_ERROR).build();
		}
	}

	@GET
	@Path("/faqs")
	@Produces({MediaType.APPLICATION_JSON})
	public Response getHelpFaqs(@Context SecurityContext sc, @Context UriInfo info) {
		try {
			List<Bson> conditions = new ArrayList<Bson>();
			
			for (String key : info.getQueryParameters().keySet()) {
				HelpfaqFields field = HelpfaqFields.byId(key);
				if (field != null) {
					List<Bson> subConditions = new ArrayList<Bson>();
					for (String value : info.getQueryParameters().get(key)) {
						if (field.getType().equals("Boolean")) {
							subConditions.add(eq(key, new Boolean(value)));
						} else {
							subConditions.add(eq(key, value));
						}
					}
					conditions.add(or(subConditions));
				}
			}
			
			List<HelpfaqData> datas = null;
			if (conditions.size() > 0) {
				datas = HelpfaqCollection.get(and(conditions));
			} else {
				datas = HelpfaqCollection.getAll();
			}
			
			List<HelpFaqBean> beanList = new ArrayList<HelpFaqBean>();
			for (HelpfaqData data : datas) {
				HelpFaqBean bean = new HelpFaqBean();
				bean.lastUpdateDate = TimeHelper.toIntegers(data.getLastUpdateDate());
				bean.id = data.getId();
				bean.title = data.getTitle();
				bean.creationDate = TimeHelper.toIntegers(data.getCreationDate());
				bean.content = data.getContent();
				
				beanList.add(bean);
			}
			
			return Response.status(Status.OK).entity(beanList.toArray(new HelpFaqBean[beanList.size()])).build();
			
		} catch (APWebException e) {
			return sendException(e);
		} catch (Exception e) {
			return Response.status(Status.INTERNAL_SERVER_ERROR).build();
		}
	}

}
